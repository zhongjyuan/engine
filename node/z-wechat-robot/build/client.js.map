{"version":3,"sources":["../src/client.js"],"names":["AlreadyLogoutError","message","constructor","__proto__","prototype","Error","WeChatClient","data","_","extend","EventEmitter","_config","_deviceId","_user","_cookie","_prop","uuid","uin","sid","skey","passTicket","formatedSyncKey","webwxAuthTicket","webwxDataTicket","syncKey","List","STATE","_data","_request","Request","Cookie","Uin","parseInt","Sid","Skey","DeviceID","emit","SyncKey","syncKeyList","SyncCheckKey","item","push","Key","Val","join","method","url","API_jsLogin","res","window","QRLogin","eval","code","tips","now","Math","floor","Date","params","toString","r","tip","loginicon","API_login","redirectUri","redirect_uri","Domain","match","userAvatar","fun","mod","version","headers","extspam","UOSExtspam","UOSClientVersion","pm","forEach","test","BaseRequest","_baseRequest","API_webwxinit","initData","BaseResponse","Ret","SYNCCHECK_RET_LOGOUT","SKey","_updateSyncKey","Object","assign","User","toUserName","lang","Lang","pass_ticket","Code","FromUserName","UserName","ToUserName","ClientMsgId","API_webwxstatusnotify","responseData","seq","API_webwxgetcontact","contacts","type","Count","length","API_webwxbatchgetcontact","ContactList","deviceid","synckey","API_synccheck","synccheck","ex","retcode","selector","SYNCCHECK_RET_SUCCESS","rr","API_webwxsync","clientMessageId","Scene","Msg","Type","MSGTYPE_TEXT","Content","LocalID","API_webwxsendmsg","id","MSGTYPE_EMOTICON","EmojiFlag","indexOf","MediaId","EMoticonMd5","API_webwxsendemoticon","file","filename","name","size","ext","mediatype","File","Blob","Buffer","isBuffer","mime","lookup","readable","path","basename","Promise","resolve","reject","pipe","err","buffer","toLowerCase","uploadMediaRequest","JSON","stringify","ClientMediaId","TotalLen","StartPos","DataLen","MediaType","UploadType","form","FormData","append","toGMTString","encodeURI","contentType","knownLength","formDataPromise","isBrowserEnv","getHeaders","f","requestData","API_webwxuploadmedia","mediaId","MSGTYPE_IMAGE","API_webwxsendmsgimg","MSGTYPE_VIDEO","API_webwxsendmsgvedio","content","APPMSGTYPE_ATTACH","API_webwxsendappmsg","MsgType","replace","MSGTYPE_MICROVIDEO","MSGTYPE_APP","SubMsgType","MSGTYPE_LOCATION","OriContent","AppMsgType","messageId","SvrMsgId","API_webwxrevokemsg","result","MsgID","responseType","API_webwxgetmsgimg","Range","API_webwxgetvideo","API_webwxgetvoice","FileName","sender","mediaid","fromuser","webwx_data_ticket","API_webwxdownloadmedia","HeadImgUrl","BaseHost","Ticket","Opcode","VerifyUserListSize","VerifyUserList","Value","VerifyUserTicket","VerifyContent","SceneListCount","SceneList","API_webwxverifyuser","NickName","Topic","MemberList","MemberCount","API_webwxcreatechatroom","ChatRoomUserName","ChatRoomName","AddMemberList","DelMemberList","InviteMemberList","API_webwxupdatechatroom","NewName","NewTopic","RemarkName","CmdId","API_webwxoplog","OP","text","actions","action","time","Text","API_webwxreport","redirect","API_webwxlogout","keys","key"],"mappings":"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","file":"client.js","sourcesContent":["import _ from \"lodash\";\r\n\r\nimport bl from \"bl\";\r\nimport path from \"path\";\r\nimport mime from \"mime\";\r\nimport FormData from \"form-data\";\r\nimport EventEmitter from \"events\";\r\n\r\nimport { Request } from \"./request\";\r\nimport { getConfig } from \"./global\";\r\nimport { equal, notEqual, isBrowserEnv, generateDeviceID, generateClientMsgID } from \"./util\";\r\n\r\nexport class AlreadyLogoutError extends Error {\r\n\tconstructor(message = \"already logout\") {\r\n\t\tsuper(message);\r\n\r\n\t\tthis.constructor = AlreadyLogoutError;\r\n\r\n\t\tthis.__proto__ = AlreadyLogoutError.prototype;\r\n\t}\r\n}\r\n\r\n/**\r\n * 微信客户端对象\r\n */\r\nexport default class WeChatClient {\r\n\t/**\r\n\t * 微信客户端构造函数\r\n\t * @param {*} data 客户端数据对象\r\n\t */\r\n\tconstructor(data) {\r\n\t\t// 用EventEmitter扩展this对象，使其具备事件监听和触发的能力\r\n\t\t_.extend(this, new EventEmitter());\r\n\r\n\t\t/**配置对象 */\r\n\t\tthis._config = getConfig();\r\n\t\t/**设备ID */\r\n\t\tthis._deviceId = generateDeviceID();\r\n\t\t/**当前用户对象 */\r\n\t\tthis._user = {};\r\n\t\t/**请求Cookie */\r\n\t\tthis._cookie = {};\r\n\t\t/**核心属性对象 */\r\n\t\tthis._prop = {\r\n\t\t\tuuid: \"\",\r\n\t\t\tuin: \"\",\r\n\t\t\tsid: \"\",\r\n\t\t\tskey: \"\",\r\n\t\t\tpassTicket: \"\",\r\n\t\t\tformatedSyncKey: \"\",\r\n\t\t\twebwxAuthTicket: \"\",\r\n\t\t\twebwxDataTicket: \"\",\r\n\t\t\tsyncKey: { List: [] },\r\n\t\t};\r\n\t\t/**状态对象 */\r\n\t\tthis.STATE = this._config.STATE;\r\n\t\t/**通用数据对象 */\r\n\t\tthis._data = data || {};\r\n\t\t/**请求对象 */\r\n\t\tthis._request = new Request({ Cookie: this._cookie });\r\n\t}\r\n\r\n\t/**通用数据对象 */\r\n\tset Data(data) {\r\n\t\t/**\r\n\t\t * 遍历 data 对象的键，并将对应键的值复制给 this 对象的相应属性\r\n\t\t */\r\n\t\tObject.keys(data).forEach((key) => {\r\n\t\t\tObject.assign(this[key], data[key]);\r\n\t\t});\r\n\t}\r\n\r\n\t/**通用数据对象 */\r\n\tget Data() {\r\n\t\treturn {\r\n\t\t\t_config: this._config,\r\n\t\t\t_deviceId: this._deviceId,\r\n\t\t\t_user: this._user,\r\n\t\t\t_cookie: this._cookie,\r\n\t\t\t_prop: this._prop,\r\n\t\t\t_data: this._data,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * 基础请求对象\r\n\t * @returns 基础请求对象\r\n\t */\r\n\t_baseRequest() {\r\n\t\treturn {\r\n\t\t\tUin: parseInt(this._prop.uin),\r\n\t\t\tSid: this._prop.sid,\r\n\t\t\tSkey: this._prop.skey,\r\n\t\t\tDeviceID: this._deviceId,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * 更新同步键\r\n\t * @param {*} data 同步数据对象\r\n\t */\r\n\t_updateSyncKey(data) {\r\n\t\tthis.emit(\"update_synckey\", data);\r\n\t\tif (data.SyncKey) {\r\n\t\t\tthis._prop.syncKey = data.SyncKey;\r\n\t\t}\r\n\r\n\t\tlet syncKeyList = [];\r\n\r\n\t\tif (data.SyncCheckKey) {\r\n\t\t\tfor (let item of data.SyncCheckKey.List) {\r\n\t\t\t\tsyncKeyList.push(`${item.Key}_${item.Val}`);\r\n\t\t\t}\r\n\t\t} else if (!this._prop.formatedSyncKey && data.SyncKey) {\r\n\t\t\tfor (let item of data.SyncKey.List) {\r\n\t\t\t\tsyncKeyList.push(`${item.Key}_${item.Val}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._prop.formatedSyncKey = syncKeyList.join(\"|\");\r\n\t}\r\n\r\n\t/**\r\n\t * 获取 UUID\r\n\t * @returns {Promise<string>} Promise 对象，包含获取到的 UUID 字符串\r\n\t */\r\n\tasync getUUID() {\r\n\t\ttry {\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\turl: this._config.API_jsLogin,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"jsLogin_response\", res);\r\n\r\n\t\t\tlet window = {\r\n\t\t\t\tQRLogin: {},\r\n\t\t\t};\r\n\r\n\t\t\teval(res.data);\r\n\t\t\tequal(window.QRLogin.code, 200, res);\r\n\r\n\t\t\tthis._prop.uuid = window.QRLogin.uuid;\r\n\r\n\t\t\treturn window.QRLogin.uuid;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"jsLogin_error\", err);\r\n\t\t\terr.tips = \"获取UUID异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 检查登录状态\r\n\t * @returns {Promise<object>} Promise 对象，包含检查结果的对象\r\n\t */\r\n\tasync checkLogin() {\r\n\t\ttry {\r\n\t\t\tlet now = Math.floor(Date.now() / 1000);\r\n\r\n\t\t\tlet params = {\r\n\t\t\t\t_: now.toString(),\r\n\t\t\t\tr: Math.floor(now / 1579).toString(),\r\n\t\t\t\ttip: 0,\r\n\t\t\t\tloginicon: true,\r\n\t\t\t\tuuid: this._prop.uuid,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"loginCheck_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_login,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"loginCheck_response\", res);\r\n\r\n\t\t\tlet window = {};\r\n\r\n\t\t\teval(res.data);\r\n\t\t\tnotEqual(window.code, 400, res);\r\n\r\n\t\t\tif (window.code === 200) {\r\n\t\t\t\tthis.redirectUri = window.redirect_uri;\r\n\t\t\t\tthis._config = getConfig({ Domain: window.redirect_uri.match(/(?:\\w+\\.)+\\w+/)[0] });\r\n\t\t\t} else if (window.code === 201 && window.userAvatar) {\r\n\t\t\t\tthis._user.userAvatar = window.userAvatar;\r\n\t\t\t}\r\n\r\n\t\t\treturn window;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"loginCheck_error\", err);\r\n\t\t\terr.tips = \"获取手机确认登录信息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 登录\r\n\t * @returns {Promise<void>} Promise 对象，表示登录操作完成\r\n\t */\r\n\tasync login() {\r\n\t\ttry {\r\n\t\t\tlet params = {\r\n\t\t\t\tfun: \"new\",\r\n\t\t\t\tmod: \"desktop\",\r\n\t\t\t\tversion: \"v2\",\r\n\t\t\t};\r\n\t\t\tthis.emit(\"login_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\textspam: this._config.UOSExtspam,\r\n\t\t\t\t\t\"client-version\": this._config.UOSClientVersion,\r\n\t\t\t\t},\r\n\t\t\t\turl: this.redirectUri,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"login_response\", res);\r\n\r\n\t\t\tlet pm = res.data.match(/<ret>(.*)<\\/ret>/);\r\n\t\t\tif (pm && pm[1] === \"0\") {\r\n\t\t\t\tthis._prop.skey = res.data.match(/<skey>(.*)<\\/skey>/)[1];\r\n\t\t\t\tthis._prop.sid = res.data.match(/<wxsid>(.*)<\\/wxsid>/)[1];\r\n\t\t\t\tthis._prop.uin = res.data.match(/<wxuin>(.*)<\\/wxuin>/)[1];\r\n\t\t\t\tthis._prop.passTicket = res.data.match(/<pass_ticket>(.*)<\\/pass_ticket>/)[1];\r\n\t\t\t}\r\n\r\n\t\t\tif (res.headers[\"set-cookie\"]) {\r\n\t\t\t\tres.headers[\"set-cookie\"].forEach((item) => {\r\n\t\t\t\t\tif (/webwx.*?data.*?ticket/i.test(item)) {\r\n\t\t\t\t\t\tthis._prop.webwxDataTicket = item.match(/=(.*?);/)[1];\r\n\t\t\t\t\t} else if (/webwx.*?auth.*?ticket/i.test(item)) {\r\n\t\t\t\t\t\tthis._prop.webwxAuthTicket = item.match(/=(.*?);/)[1];\r\n\t\t\t\t\t} else if (/wxuin/i.test(item)) {\r\n\t\t\t\t\t\tthis._prop.uin = item.match(/=(.*?);/)[1];\r\n\t\t\t\t\t} else if (/wxsid/i.test(item)) {\r\n\t\t\t\t\t\tthis._prop.sid = item.match(/=(.*?);/)[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis._cookie = res.headers[\"set-cookie\"];\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"login_error\", err);\r\n\t\t\terr.tips = \"登录异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化微信\r\n\t * @returns {Promise<Object>} Promise 对象，表示初始化操作完成，并返回初始化后的数据对象\r\n\t */\r\n\tasync init() {\r\n\t\ttry {\r\n\t\t\tconst params = { _: Math.floor(Date.now() / 1000).toString() };\r\n\t\t\tconst data = { BaseRequest: this._baseRequest() };\r\n\t\t\tthis.emit(\"webwxinit_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_webwxinit,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxinit_response\", res);\r\n\r\n\t\t\tconst initData = res.data;\r\n\t\t\tif (initData.BaseResponse.Ret == this._config.SYNCCHECK_RET_LOGOUT) {\r\n\t\t\t\tthrow new AlreadyLogoutError();\r\n\t\t\t}\r\n\r\n\t\t\tequal(initData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\tthis._prop.skey = initData.SKey || this._prop.skey;\r\n\r\n\t\t\tthis._updateSyncKey(initData);\r\n\r\n\t\t\tObject.assign(this._user, initData.User);\r\n\r\n\t\t\treturn initData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxinit_error\", err);\r\n\t\t\terr.tips = \"初始化异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送手机状态通知\r\n\t * @param {string} toUserName - 接收通知的用户ID（可选）\r\n\t * @returns {Promise<void>} Promise 对象，表示手机状态通知操作完成\r\n\t */\r\n\tasync sendMobileNotification(toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tCode: toUserName ? 1 : 3,\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\tToUserName: toUserName || this._user.UserName,\r\n\t\t\t\tClientMsgId: generateClientMsgID(),\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxstatusnotify_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_webwxstatusnotify,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxstatusnotify_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxstatusnotify_error\", err);\r\n\t\t\terr.tips = \"手机状态通知异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取通讯录\r\n\t * @param {number} seq - 通讯录序列号（可选，默认为0）\r\n\t * @returns {Promise<Object>} Promise 对象，表示获取通讯录的结果\r\n\t */\r\n\tasync fetchContacts(seq = 0) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tr: +new Date(),\r\n\t\t\t\tseq: seq,\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxgetcontact_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_webwxgetcontact,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxgetcontact_response\", res);\r\n\r\n\t\t\tconst data = res.data;\r\n\t\t\tequal(data.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn data;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxgetcontact_error\", err);\r\n\t\t\terr.tips = \"获取通讯录异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 批量获取联系人详细信息\r\n\t * @param {Array} contacts - 联系人列表\r\n\t * @returns {Promise<Array>} - Promise 对象，表示批量获取联系人详细信息的结果\r\n\t */\r\n\tasync fetchBatchContactInfo(contacts) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tr: +new Date(),\r\n\t\t\t\ttype: \"ex\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tCount: contacts.length,\r\n\t\t\t\tList: contacts,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxbatchgetcontact_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxbatchgetcontact,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxbatchgetcontact_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData.ContactList;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxbatchgetcontact_error\", err);\r\n\t\t\terr.tips = \"批量获取联系人异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 执行同步检查\r\n\t * @returns {Promise<number>} Promise 对象，表示同步检查结果中的 selector 值\r\n\t */\r\n\tasync performSyncCheck() {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\t_: (Date.now() * 1).toString(),\r\n\t\t\t\tr: (Date.now() * 1).toString(),\r\n\t\t\t\tuin: this._prop.uin,\r\n\t\t\t\tsid: this._prop.sid,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t\tdeviceid: this._baseRequest().DeviceID,\r\n\t\t\t\tsynckey: this._prop.formatedSyncKey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"synccheck_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_synccheck,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"synccheck_response\", res);\r\n\r\n\t\t\tlet window = {\r\n\t\t\t\tsynccheck: {},\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\teval(res.data);\r\n\t\t\t} catch (ex) {\r\n\t\t\t\twindow.synccheck = { retcode: \"0\", selector: \"0\" };\r\n\t\t\t}\r\n\r\n\t\t\tif (window.synccheck.retcode == this._config.SYNCCHECK_RET_LOGOUT) {\r\n\t\t\t\tthrow new AlreadyLogoutError();\r\n\t\t\t}\r\n\r\n\t\t\tequal(window.synccheck.retcode, this._config.SYNCCHECK_RET_SUCCESS, res);\r\n\r\n\t\t\treturn window.synccheck.selector;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"synccheck_error\", err);\r\n\t\t\terr.tips = \"同步检查异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 执行同步操作\r\n\t * @returns {Promise<Object>} Promise 对象，表示同步结果的数据对象\r\n\t */\r\n\tasync performSync() {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tsid: this._prop.sid,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tSyncKey: this._prop.syncKey,\r\n\t\t\t\trr: ~new Date(),\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxsync_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsync,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsync_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\r\n\t\t\tif (responseData.BaseResponse.Ret == this._config.SYNCCHECK_RET_LOGOUT) {\r\n\t\t\t\tthrow new AlreadyLogoutError();\r\n\t\t\t}\r\n\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\tthis._updateSyncKey(responseData);\r\n\t\t\tthis._prop.skey = responseData.SKey || this._prop.skey;\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsync_error\", err);\r\n\t\t\terr.tips = \"获取新信息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送文本消息\r\n\t * @param {string} message - 要发送的消息内容\r\n\t * @param {string} toUserName - 目标用户的 UserName\r\n\t * @returns {Promise<Object>} Promise 对象，表示发送消息结果的数据对象\r\n\t * @throws {Error} 如果发送消息失败，则会抛出异常\r\n\t */\r\n\tasync sendTextMessage(message, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tconst data = {\r\n\t\t\t\tScene: 0,\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: this._config.MSGTYPE_TEXT,\r\n\t\t\t\t\tContent: message,\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user[\"UserName\"],\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxsendmsg_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsendmsg,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsendmsg_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsendmsg_error\", err);\r\n\t\t\terr.tips = \"发送文本信息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送表情消息\r\n\t * @param {string} id - 表情消息ID，可以是 MediaId 或 EMoticonMd5\r\n\t * @param {string} toUserName - 目标用户的 UserName\r\n\t * @returns {Promise<Object>} Promise 对象，表示发送消息结果的数据对象\r\n\t * @throws {Error} 如果发送消息失败，则会抛出异常\r\n\t */\r\n\tasync sendEmoticonMessage(id, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tfun: \"sys\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tScene: 0,\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: this._config.MSGTYPE_EMOTICON,\r\n\t\t\t\t\tEmojiFlag: 2,\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user[\"UserName\"],\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tif (id.indexOf(\"@\") === 0) {\r\n\t\t\t\tdata.Msg.MediaId = id;\r\n\t\t\t} else {\r\n\t\t\t\tdata.Msg.EMoticonMd5 = id;\r\n\t\t\t}\r\n\t\t\tthis.emit(\"webwxsendemoticon_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsendemoticon,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsendemoticon_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsendemoticon_error\", err);\r\n\t\t\terr.tips = \"发送表情信息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 上传媒体文件\r\n\t * @param {Stream|Buffer} file - 要上传的文件流或缓冲区\r\n\t * @param {string} filename - 文件名（可选）\r\n\t * @param {string} toUserName - 接收方用户名（可选）\r\n\t * @returns {Promise<Object>} - 上传成功后返回的媒体信息对象\r\n\t */\r\n\tasync uploadMedia(file, filename, toUserName) {\r\n\t\ttry {\r\n\t\t\tlet name, type, size, ext, mediatype, data;\r\n\r\n\t\t\t// 根据不同类型的文件处理数据\r\n\t\t\tif ((typeof File !== \"undefined\" && file.constructor == File) || (typeof Blob !== \"undefined\" && file.constructor == Blob)) {\r\n\t\t\t\tname = file.name || \"file\";\r\n\t\t\t\ttype = file.type;\r\n\t\t\t\tsize = file.size;\r\n\t\t\t\tdata = file;\r\n\t\t\t} else if (Buffer.isBuffer(file)) {\r\n\t\t\t\tif (!filename) {\r\n\t\t\t\t\tthrow new Error(\"未知文件名\");\r\n\t\t\t\t}\r\n\t\t\t\tname = filename;\r\n\t\t\t\ttype = mime.lookup(name);\r\n\t\t\t\tsize = file.length;\r\n\t\t\t\tdata = file;\r\n\t\t\t} else if (file.readable) {\r\n\t\t\t\tif (!file.path && !filename) {\r\n\t\t\t\t\tthrow new Error(\"未知文件名\");\r\n\t\t\t\t}\r\n\t\t\t\tname = path.basename(file.path || filename);\r\n\t\t\t\ttype = mime.lookup(name);\r\n\t\t\t\tconst buffer = await new Promise((resolve, reject) => {\r\n\t\t\t\t\tfile.pipe(\r\n\t\t\t\t\t\tbl((err, buffer) => {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve(buffer);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t\tsize = buffer.length;\r\n\t\t\t\tdata = buffer;\r\n\t\t\t}\r\n\r\n\t\t\text = name.match(/.*\\.(.*)/);\r\n\t\t\text = ext ? ext[1].toLowerCase() : \"\";\r\n\r\n\t\t\t// 根据文件扩展名确定媒体类型\r\n\t\t\tswitch (ext) {\r\n\t\t\t\tcase \"bmp\":\r\n\t\t\t\tcase \"jpeg\":\r\n\t\t\t\tcase \"jpg\":\r\n\t\t\t\tcase \"png\":\r\n\t\t\t\t\tmediatype = \"pic\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"mp4\":\r\n\t\t\t\t\tmediatype = \"video\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tmediatype = \"doc\";\r\n\t\t\t}\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\r\n\t\t\tconst uploadMediaRequest = JSON.stringify({\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tClientMediaId: clientMessageId,\r\n\t\t\t\tTotalLen: size,\r\n\t\t\t\tStartPos: 0,\r\n\t\t\t\tDataLen: size,\r\n\t\t\t\tMediaType: 4,\r\n\t\t\t\tUploadType: 2,\r\n\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\tToUserName: toUserName || this._user.UserName,\r\n\t\t\t});\r\n\r\n\t\t\tconst form = new FormData();\r\n\t\t\tform.append(\"name\", name);\r\n\t\t\tform.append(\"type\", type);\r\n\t\t\tform.append(\"lastModifiedDate\", new Date().toGMTString());\r\n\t\t\tform.append(\"size\", size);\r\n\t\t\tform.append(\"mediatype\", mediatype);\r\n\t\t\tform.append(\"uploadmediarequest\", uploadMediaRequest);\r\n\t\t\tform.append(\"webwx_data_ticket\", this._prop.webwxDataTicket);\r\n\t\t\tform.append(\"pass_ticket\", encodeURI(this._prop.passTicket));\r\n\t\t\tform.append(\"filename\", data, {\r\n\t\t\t\tfilename: name,\r\n\t\t\t\tcontentType: type,\r\n\t\t\t\tknownLength: size,\r\n\t\t\t});\r\n\r\n\t\t\tconst formDataPromise = new Promise((resolve, reject) => {\r\n\t\t\t\tif (isBrowserEnv) {\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\tdata: form,\r\n\t\t\t\t\t\theaders: {},\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tform.pipe(\r\n\t\t\t\t\t\tbl((err, buffer) => {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\t\tdata: buffer,\r\n\t\t\t\t\t\t\t\t\theaders: form.getHeaders(),\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar params = { f: \"json\" };\r\n\t\t\tvar requestData = (await formDataPromise).data;\r\n\t\t\tthis.emit(\"webwxuploadmedia_request\", { params: params, data: requestData });\r\n\r\n\t\t\t// 发起上传请求\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: requestData,\r\n\t\t\t\turl: this._config.API_webwxuploadmedia,\r\n\t\t\t\theaders: (await formDataPromise).headers,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxuploadmedia_response\", res);\r\n\r\n\t\t\tconst mediaId = res.data.MediaId;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tname: name,\r\n\t\t\t\tsize: size,\r\n\t\t\t\text: ext,\r\n\t\t\t\tmediatype: mediatype,\r\n\t\t\t\tmediaId: mediaId,\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxuploadmedia_error\", err);\r\n\t\t\terr.tips = \"上传媒体文件异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送图片消息\r\n\t * @param {string} mediaId - 媒体文件的ID\r\n\t * @param {string} toUserName - 接收方用户名\r\n\t * @returns {Promise<Object>} - 发送成功后返回的消息对象\r\n\t */\r\n\tasync sendPictureMessage(mediaId, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tf: \"json\",\r\n\t\t\t\tfun: \"async\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tScene: 0,\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: this._config.MSGTYPE_IMAGE,\r\n\t\t\t\t\tMediaId: mediaId,\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxsendmsgimg_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsendmsgimg,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsendmsgimg_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsendmsgimg_error\", err);\r\n\t\t\terr.tips = \"发送图片异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送视频消息\r\n\t * @param {string} mediaId - 媒体文件的ID\r\n\t * @param {string} toUserName - 接收方用户名\r\n\t * @returns {Promise<Object>} - 发送成功后返回的消息对象\r\n\t */\r\n\tasync sendVideoMessage(mediaId, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tf: \"json\",\r\n\t\t\t\tfun: \"async\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tScene: 0,\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: this._config.MSGTYPE_VIDEO,\r\n\t\t\t\t\tMediaId: mediaId,\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxsendmsgvedio_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsendmsgvedio,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsendmsgvedio_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsendmsgvedio_error\", err);\r\n\t\t\terr.tips = \"发送视频异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送文件消息\r\n\t * @param {string} mediaId - 媒体文件的ID\r\n\t * @param {string} name - 文件名\r\n\t * @param {number} size - 文件大小（字节）\r\n\t * @param {string} ext - 文件扩展名\r\n\t * @param {string} toUserName - 接收方用户名\r\n\t * @returns {Promise<Object>} - 发送成功后返回的消息对象\r\n\t */\r\n\tasync sendDocumentMessage(mediaId, name, size, ext, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tf: \"json\",\r\n\t\t\t\tfun: \"async\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tconst content = `\r\n\t\t\t\t<appmsg appid='wxeb7ec651dd0aefa9' sdkver=''>\r\n\t\t\t\t\t<title>${name}</title>\r\n\t\t\t\t\t<des></des>\r\n\t\t\t\t\t<action></action>\r\n\t\t\t\t\t<type>6</type>\r\n\t\t\t\t\t<content></content>\r\n\t\t\t\t\t<url></url>\r\n\t\t\t\t\t<lowurl></lowurl>\r\n\t\t\t\t\t<appattach>\r\n\t\t\t\t\t\t<totallen>${size}</totallen>\r\n\t\t\t\t\t\t<attachid>${mediaId}</attachid>\r\n\t\t\t\t\t\t<fileext>${ext}</fileext>\r\n\t\t\t\t\t</appattach>\r\n\t\t\t\t\t<extinfo></extinfo>\r\n\t\t\t\t</appmsg>`;\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tScene: 0,\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: this._config.APPMSGTYPE_ATTACH,\r\n\t\t\t\t\tContent: content,\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxsendappmsg_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxsendappmsg,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxsendappmsg_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxsendappmsg_error\", err);\r\n\t\t\terr.tips = \"发送文件异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 转发消息\r\n\t * @param {Object} message - 需要转发的消息对象\r\n\t * @param {string} toUserName - 接收方用户名\r\n\t * @returns {Promise<Object>} - 转发成功后返回的消息对象\r\n\t */\r\n\tasync forwardMessage(message, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tf: \"json\",\r\n\t\t\t\tfun: \"async\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst clientMessageId = generateClientMsgID();\r\n\t\t\tlet data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tScene: 2,\r\n\t\t\t\tMsg: {\r\n\t\t\t\t\tType: message.MsgType,\r\n\t\t\t\t\tMediaId: \"\",\r\n\t\t\t\t\tContent: message.Content.replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\"),\r\n\t\t\t\t\tToUserName: toUserName,\r\n\t\t\t\t\tLocalID: clientMessageId,\r\n\t\t\t\t\tClientMsgId: clientMessageId,\r\n\t\t\t\t\tFromUserName: this._user.UserName,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tlet url;\r\n\t\t\tswitch (message.MsgType) {\r\n\t\t\t\tcase this._config.MSGTYPE_TEXT:\r\n\t\t\t\t\turl = this._config.API_webwxsendmsg;\r\n\t\t\t\t\tif (message.SubMsgType === this._config.MSGTYPE_LOCATION) {\r\n\t\t\t\t\t\tdata.Msg.Type = this._config.MSGTYPE_LOCATION;\r\n\t\t\t\t\t\tdata.Msg.Content = message.OriContent.replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase this._config.MSGTYPE_IMAGE:\r\n\t\t\t\t\turl = this._config.API_webwxsendmsgimg;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase this._config.MSGTYPE_EMOTICON:\r\n\t\t\t\t\tparams.fun = \"sys\";\r\n\t\t\t\t\turl = this._config.API_webwxsendemoticon;\r\n\t\t\t\t\tdata.Msg.EMoticonMd5 = message.Content.replace(/^[\\s\\S]*?md5\\s?=\\s?\"(.*?)\"[\\s\\S]*?$/, \"$1\");\r\n\t\t\t\t\tif (!data.Msg.EMoticonMd5) {\r\n\t\t\t\t\t\tthrow new Error(\"商店表情不能转发\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata.Scene = 0;\r\n\t\t\t\t\tdata.Msg.EmojiFlag = 2;\r\n\t\t\t\t\tdelete data.Msg.MediaId;\r\n\t\t\t\t\tdelete data.Msg.Content;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase this._config.MSGTYPE_MICROVIDEO:\r\n\t\t\t\tcase this._config.MSGTYPE_VIDEO:\r\n\t\t\t\t\turl = this._config.API_webwxsendmsgvedio;\r\n\t\t\t\t\tdata.Msg.Type = this._config.MSGTYPE_VIDEO;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase this._config.MSGTYPE_APP:\r\n\t\t\t\t\turl = this._config.API_webwxsendappmsg;\r\n\t\t\t\t\tdata.Msg.Type = message.AppMsgType;\r\n\t\t\t\t\tdata.Msg.Content = data.Msg.Content.replace(\r\n\t\t\t\t\t\t/^[\\s\\S]*?(<appmsg[\\s\\S]*?<attachid>)[\\s\\S]*?(<\\/attachid>[\\s\\S]*?<\\/appmsg>)[\\s\\S]*?$/,\r\n\t\t\t\t\t\t`$1${message.MediaId}$2`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.emit(\"forwardMessage_error\", new Error(\"该消息类型不能直接转发\"));\r\n\t\t\t\t\tthrow new Error(\"该消息类型不能直接转发\");\r\n\t\t\t}\r\n\t\t\tthis.emit(\"forwardMessage_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: url,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"forwardMessage_response\", res);\r\n\r\n\t\t\tconst responseData = res.data;\r\n\t\t\tequal(responseData.BaseResponse.Ret, 0, res);\r\n\r\n\t\t\treturn responseData;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"forwardMessage_error\", err);\r\n\t\t\terr.tips = \"转发消息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 撤回消息\r\n\t * @param {string} messageId - 待撤回的消息ID\r\n\t * @param {string} toUserName - 消息所在的聊天对象的用户名\r\n\t * @returns {Promise<Object>} - 包含操作结果的对象\r\n\t */\r\n\tasync revokeMessage(messageId, toUserName) {\r\n\t\ttry {\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tSvrMsgId: messageId,\r\n\t\t\t\tToUserName: toUserName,\r\n\t\t\t\tClientMsgId: generateClientMsgID(),\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxrevokemsg_request\", { params: null, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxrevokemsg,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxrevokemsg_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`撤回消息失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxrevokemsg_error\", err);\r\n\t\t\terr.tips = \"撤回消息异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取消息图片或表情\r\n\t * @param {string} messageId - 消息ID\r\n\t * @returns {Promise<Object>} - 包含图片或表情数据和类型的对象\r\n\t */\r\n\tasync getMessageImg(messageId) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\ttype: \"big\",\r\n\t\t\t\tMsgID: messageId,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxgetmsgimg_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tresponseType: \"arraybuffer\",\r\n\t\t\t\turl: this._config.API_webwxgetmsgimg,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxgetmsgimg_response\", res);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: res.data,\r\n\t\t\t\ttype: res.headers[\"content-type\"],\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxgetmsgimg_error\", err);\r\n\t\t\terr.tips = \"获取图片或表情异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取视频\r\n\t * @param {string} messageId - 消息ID\r\n\t * @returns {Promise<Object>} - 包含视频数据和类型的对象\r\n\t */\r\n\tasync getMessageVideo(messageId) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tMsgID: messageId,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxgetvideo_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tRange: \"bytes=0-\",\r\n\t\t\t\t},\r\n\t\t\t\tparams: params,\r\n\t\t\t\tresponseType: \"arraybuffer\",\r\n\t\t\t\turl: this._config.API_webwxgetvideo,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxgetvideo_response\", res);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: res.data,\r\n\t\t\t\ttype: res.headers[\"content-type\"],\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxgetvideo_error\", err);\r\n\t\t\terr.tips = \"获取视频异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取声音\r\n\t * @param {string} messageId - 消息ID\r\n\t * @returns {Promise<Object>} - 包含声音数据和类型的对象\r\n\t */\r\n\tasync getMessageVoice(messageId) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tMsgID: messageId,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxgetvoice_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tresponseType: \"arraybuffer\",\r\n\t\t\t\turl: this._config.API_webwxgetvoice,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxgetvoice_response\", res);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: res.data,\r\n\t\t\t\ttype: res.headers[\"content-type\"],\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxgetvoice_error\", err);\r\n\t\t\terr.tips = \"获取声音异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取文件\r\n\t * @param {string} FromUserName - 发送者用户名\r\n\t * @param {string} MediaId - 文件的媒体ID\r\n\t * @param {string} FileName - 文件名\r\n\t * @returns {Promise<Object>} - 包含文件数据和类型的对象\r\n\t */\r\n\tasync getMessageDocument(FromUserName, MediaId, FileName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tsender: FromUserName,\r\n\t\t\t\tmediaid: MediaId,\r\n\t\t\t\tfilename: FileName,\r\n\t\t\t\tfromuser: this._user.UserName,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t\twebwx_data_ticket: this._prop.webwxDataTicket,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxdownloadmedia_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tresponseType: \"arraybuffer\",\r\n\t\t\t\turl: this._config.API_webwxdownloadmedia,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxdownloadmedia_response\", res);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: res.data,\r\n\t\t\t\ttype: res.headers[\"content-type\"],\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxdownloadmedia_error\", err);\r\n\t\t\terr.tips = \"获取文件异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取头像图片\r\n\t * @param {string} HeadImgUrl - 头像图片的URL\r\n\t * @returns {Promise<Object>} - 包含头像图片数据和类型的对象\r\n\t */\r\n\tasync getHeadImg(HeadImgUrl) {\r\n\t\ttry {\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"GET\",\r\n\t\t\t\turl: this._config.BaseHost + HeadImgUrl,\r\n\t\t\t\tresponseType: \"arraybuffer\",\r\n\t\t\t});\r\n\t\t\tthis.emit(\"headimage_response\", res);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: res.data,\r\n\t\t\t\ttype: res.headers[\"content-type\"],\r\n\t\t\t};\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"headimage_error\", err);\r\n\t\t\terr.tips = \"获取头像异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 通过好友请求\r\n\t * @param {string} UserName - 好友的用户名\r\n\t * @param {string} Ticket - 好友的验证票据\r\n\t * @returns {Promise<Object>} - 包含通过好友请求后返回的数据的对象\r\n\t */\r\n\tasync verifyUser(UserName, Ticket) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tOpcode: 3,\r\n\t\t\t\tVerifyUserListSize: 1,\r\n\t\t\t\tVerifyUserList: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tValue: UserName,\r\n\t\t\t\t\t\tVerifyUserTicket: Ticket,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tVerifyContent: \"\",\r\n\t\t\t\tSceneListCount: 1,\r\n\t\t\t\tSceneList: [33],\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxverifyuser_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxverifyuser,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxverifyuser_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`通过好友请求失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxverifyuser_error\", err);\r\n\t\t\terr.tips = \"通过好友请求异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 添加好友\r\n\t * @param {string} UserName - 好友的用户名\r\n\t * @param {string} [content=我是${this._user.NickName}] - 验证消息内容，默认为当前用户的昵称\r\n\t * @returns {Promise<Object>} - 包含添加好友后返回的数据的对象\r\n\t */\r\n\tasync addFriend(UserName, content = `我是${this._user.NickName}`) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tOpcode: 2,\r\n\t\t\t\tVerifyUserListSize: 1,\r\n\t\t\t\tVerifyUserList: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tValue: UserName,\r\n\t\t\t\t\t\tVerifyUserTicket: \"\",\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tVerifyContent: content,\r\n\t\t\t\tSceneListCount: 1,\r\n\t\t\t\tSceneList: [33],\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxverifyuser_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxverifyuser,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxverifyuser_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`添加好友失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxverifyuser_error\", err);\r\n\t\t\terr.tips = \"添加好友异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 创建群聊\r\n\t * @param {string} Topic - 群聊的主题\r\n\t * @param {Array} MemberList - 成员列表，包含要邀请的成员的用户名\r\n\t * @returns {Promise<Object>} - 包含创建群聊后返回的数据的对象\r\n\t */\r\n\tasync createChatroom(Topic, MemberList) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tr: ~new Date(),\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tMemberCount: MemberList.length,\r\n\t\t\t\tMemberList: MemberList,\r\n\t\t\t\tTopic: Topic,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxcreatechatroom_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\turl: this._config.API_webwxcreatechatroom,\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxcreatechatroom_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`创建群失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxcreatechatroom_error\", err);\r\n\t\t\terr.tips = \"创建群异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 更新群聊信息（添加、删除或邀请成员）\r\n\t * @param {string} ChatRoomUserName - 群聊的用户名\r\n\t * @param {Array} MemberList - 成员列表，包含要操作的成员的用户名\r\n\t * @param {string} fun - 操作类型，可选值为 \"addmember\"、\"delmember\" 或 \"invitemember\"\r\n\t * @returns {Promise<Object>} - 包含更新群聊后返回的数据的对象\r\n\t */\r\n\tasync updateChatroom(ChatRoomUserName, MemberList, fun) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tfun: fun,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tChatRoomName: ChatRoomUserName,\r\n\t\t\t};\r\n\r\n\t\t\tif (fun === \"addmember\") {\r\n\t\t\t\tdata.AddMemberList = MemberList.toString();\r\n\t\t\t} else if (fun === \"delmember\") {\r\n\t\t\t\tdata.DelMemberList = MemberList.toString();\r\n\t\t\t} else if (fun === \"invitemember\") {\r\n\t\t\t\tdata.InviteMemberList = MemberList.toString();\r\n\t\t\t}\r\n\t\t\tthis.emit(\"webwxupdatechatroom_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxupdatechatroom,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxupdatechatroom_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`邀请或踢出群成员失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxupdatechatroom_error\", err);\r\n\t\t\terr.tips = \"邀请或踢出群成员异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 更新群名\r\n\t * @param {string} ChatRoomUserName - 群的用户名\r\n\t * @param {string} NewName - 群的新名字\r\n\t * @returns {Promise<void>} - 执行结果的Promise对象\r\n\t */\r\n\tasync updateChatRoomName(ChatRoomUserName, NewName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tfun: \"modtopic\",\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tChatRoomName: ChatRoomUserName,\r\n\t\t\t\tNewTopic: NewName,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxupdatechatroom_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxupdatechatroom,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxupdatechatroom_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`更新群名失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxupdatechatroom_error\", err);\r\n\t\t\terr.tips = \"更新群名异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 更新联系人的备注名\r\n\t * @param {string} UserName - 联系人的用户名\r\n\t * @param {string} RemarkName - 联系人的备注名\r\n\t * @returns {Promise<Object>} - 包含操作结果的对象\r\n\t */\r\n\tasync updateRemarkName(UserName, RemarkName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tCmdId: 2,\r\n\t\t\t\tRemarkName: RemarkName,\r\n\t\t\t\tUserName: UserName,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxoplog_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxoplog,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxoplog_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`设置用户标签失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxoplog_error\", err);\r\n\t\t\terr.tips = \"设置用户标签异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 置顶或取消置顶联系人\r\n\t * @param {string} UserName - 联系人的用户名\r\n\t * @param {number} OP - 操作类型，0表示取消置顶，1表示置顶\r\n\t * @param {string} RemarkName - 联系人的备注名\r\n\t * @returns {Promise<Object>} - 包含操作结果的对象\r\n\t */\r\n\tasync opLog(UserName, OP, RemarkName) {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tCmdId: 3,\r\n\t\t\t\tOP: OP,\r\n\t\t\t\tRemarkName: RemarkName,\r\n\t\t\t\tUserName: UserName,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxoplog_request\", { params: params, data: data });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxoplog,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxoplog_response\", res);\r\n\r\n\t\t\tconst result = res.data;\r\n\t\t\tif (result.BaseResponse.Ret !== 0) {\r\n\t\t\t\tthrow new Error(`置顶或取消置顶失败: ${JSON.stringify(res)}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxoplog_error\", err);\r\n\t\t\terr.tips = \"置顶或取消置顶异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 发送状态报告\r\n\t * @param {Object} text - 状态报告文本，包含操作记录等信息\r\n\t * @returns {Promise<Object>} Promise 对象，表示发送状态报告的结果\r\n\t */\r\n\tasync sendStatReport(text) {\r\n\t\ttry {\r\n\t\t\ttext = text || {\r\n\t\t\t\ttype: \"[action-record]\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tactions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"click\",\r\n\t\t\t\t\t\t\taction: \"发送框\",\r\n\t\t\t\t\t\t\ttime: +new Date(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\ttext = JSON.stringify(text);\r\n\r\n\t\t\tconst params = {\r\n\t\t\t\tfun: \"new\",\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tpass_ticket: this._prop.passTicket,\r\n\t\t\t};\r\n\r\n\t\t\tconst data = {\r\n\t\t\t\tBaseRequest: this._baseRequest(),\r\n\t\t\t\tCount: 1,\r\n\t\t\t\tList: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tText: text,\r\n\t\t\t\t\t\tType: 1,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxreport_request\", { params: params, data: data });\r\n\r\n\t\t\treturn await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\tdata: data,\r\n\t\t\t\turl: this._config.API_webwxreport,\r\n\t\t\t});\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxreport_error\", err);\r\n\t\t\terr.tips = \"状态报告异常\";\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 登出\r\n\t * @returns {Promise<string>} Promise 对象，表示登出结果的消息字符串\r\n\t */\r\n\tasync logout() {\r\n\t\ttry {\r\n\t\t\tconst params = {\r\n\t\t\t\ttype: 0,\r\n\t\t\t\tredirect: 1,\r\n\t\t\t\tlang: this._config.Lang,\r\n\t\t\t\tskey: this._prop.skey,\r\n\t\t\t};\r\n\t\t\tthis.emit(\"webwxlogout_request\", { params: params, data: null });\r\n\r\n\t\t\tconst res = await this._request({\r\n\t\t\t\tmethod: \"POST\",\r\n\t\t\t\tparams: params,\r\n\t\t\t\turl: this._config.API_webwxlogout,\r\n\t\t\t});\r\n\t\t\tthis.emit(\"webwxlogout_response\", res);\r\n\r\n\t\t\treturn \"登出成功\";\r\n\t\t} catch (err) {\r\n\t\t\tthis.emit(\"error\", err);\r\n\t\t\tthis.emit(\"webwxlogout_error\", err);\r\n\t\t\treturn \"登出异常\";\r\n\t\t}\r\n\t}\r\n}\r\n"]}